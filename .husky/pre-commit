#!/bin/bash

# Pre-commit hooks
echo "ğŸ” Running pre-commit checks..."

# ë¨¼ì € lint-staged ì‹¤í–‰
echo "ğŸ¨ Running lint-staged..."
npx lint-staged

# lint-stagedê°€ ì„±ê³µí•˜ë©´ deploy.sh ê²€ì¦ ì‹¤í–‰
if [ $? -eq 0 ]; then
    echo "ğŸ“‹ Running deployment validation..."
    
    # deploy.sh ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (í…ŒìŠ¤íŠ¸ ëª¨ë“œ)
    export NODE_ENV="test"
    export SKIP_PM2="true"
    export SKIP_HEALTH_CHECK="true"
    
    if ! ./deploy.sh; then
        echo "âŒ Deploy script validation failed! Please fix the issues before committing."
        echo "ğŸ’¡ You can run './deploy.sh' manually to see the detailed error."
        exit 1
    fi
    
    echo "âœ… All pre-commit checks passed!"
else
    echo "âŒ Lint-staged checks failed!"
    exit 1
fi
