# ì•ˆì „í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

## âš ï¸ ì¤‘ìš”: ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ì „ í•„ìˆ˜ ì‘ì—…

### 1. ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
```bash
# PostgreSQL ë°±ì—… ëª…ë ¹ì–´
pg_dump -h [í˜¸ìŠ¤íŠ¸] -U [ì‚¬ìš©ìëª…] -d [ë°ì´í„°ë² ì´ìŠ¤ëª…] > backup_$(date +%Y%m%d_%H%M%S).sql

# ì˜ˆì‹œ:
pg_dump -h localhost -U postgres -d snowmuffin > backup_$(date +%Y%m%d_%H%M%S).sql
```

### 2. ë°±ì—… ë³µêµ¬ ë°©ë²• (ë¬¸ì œ ë°œìƒ ì‹œ)
```bash
# ë°±ì—…ì—ì„œ ë³µêµ¬
psql -h [í˜¸ìŠ¤íŠ¸] -U [ì‚¬ìš©ìëª…] -d [ë°ì´í„°ë² ì´ìŠ¤ëª…] < backup_íŒŒì¼ëª….sql
```

### 3. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ì™„ë£Œ
- [ ] í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ (ì„ íƒì‚¬í•­)
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡¤ë°± ê³„íš ìˆ˜ë¦½

## ğŸ“‹ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„ë³„ ì‹¤í–‰ ê³„íš

### 1ë‹¨ê³„: ìƒˆ í…Œì´ë¸” ìƒì„± (ì•ˆì „)
- `games` í…Œì´ë¸” ìƒì„±
- `game_servers` í…Œì´ë¸” ìƒì„±
- ê¸°ì¡´ ë°ì´í„°ì— ì˜í–¥ ì—†ìŒ

### 2ë‹¨ê³„: ê¸°ì¡´ í…Œì´ë¸” í™•ì¥ (ì£¼ì˜)
- `currencies` í…Œì´ë¸”ì— ì»¬ëŸ¼ ì¶”ê°€
- ê¸°ì¡´ ë°ì´í„° ìœ ì§€ë˜ì§€ë§Œ ìƒˆ ì»¬ëŸ¼ë“¤ì€ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •

### 3ë‹¨ê³„: ì§€ê°‘ ì‹œìŠ¤í…œ ì¬êµ¬ì„± (ìœ„í—˜)
- ê¸°ì¡´ `wallets` í…Œì´ë¸” ë°±ì—… í›„ ì¬ìƒì„±
- ê¸°ì¡´ ì§€ê°‘ ë°ì´í„°ë¥¼ ìƒˆ êµ¬ì¡°ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜

### 4ë‹¨ê³„: ì´ˆê¸° ë°ì´í„° ì‚½ì… (ì•ˆì „)
- ê²Œì„, ì„œë²„, í™”í ê¸°ë³¸ ë°ì´í„° ì‚½ì…

## ğŸ›¡ï¸ ì•ˆì „í•œ ì‹¤í–‰ ëª…ë ¹ì–´

```bash
# 1. í˜„ì¬ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸
npm run migration:show

# 2. ë‹¨ê³„ë³„ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
npm run migration:run

# 3. ë¬¸ì œ ë°œìƒ ì‹œ ë¡¤ë°±
npm run migration:revert
```

## ğŸ”„ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ

### ê¸°ì¡´ wallets ë°ì´í„° ë³´ì¡´ ë°©ë²•

1. **ì„ì‹œ í…Œì´ë¸” ìƒì„±**: ê¸°ì¡´ wallets ë°ì´í„°ë¥¼ ì„ì‹œ í…Œì´ë¸”ì— ë°±ì—…
2. **ìƒˆ êµ¬ì¡° ì ìš©**: ìƒˆë¡œìš´ wallets í…Œì´ë¸” êµ¬ì¡° ìƒì„±
3. **ë°ì´í„° ë³€í™˜**: ê¸°ì¡´ ë°ì´í„°ë¥¼ ìƒˆ êµ¬ì¡°ì— ë§ê²Œ ë³€í™˜í•˜ì—¬ ì‚½ì…
4. **ê²€ì¦**: ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦
5. **ì„ì‹œ í…Œì´ë¸” ì‚­ì œ**: ê²€ì¦ ì™„ë£Œ í›„ ì„ì‹œ í…Œì´ë¸” ì œê±°

## âš¡ ë¹ ë¥¸ ì‹¤í–‰ (ìœ„í—˜ë„ë³„)

### ğŸŸ¢ ë‚®ì€ ìœ„í—˜ë„ - ì•ˆì „í•œ ë‹¨ê³„ë³„ ì‹¤í–‰ (ê¶Œì¥)
```bash
# ìë™ ë°±ì—… + ë‹¨ê³„ë³„ ì‹¤í–‰
./safe-migration.sh step
```

### ğŸŸ¡ ì¤‘ê°„ ìœ„í—˜ë„ - ì „ì²´ ë§ˆì´ê·¸ë ˆì´ì…˜
```bash
# ìë™ ë°±ì—… + ì „ì²´ ì‹¤í–‰
./safe-migration.sh all
```

### ğŸ”´ ë†’ì€ ìœ„í—˜ë„ - ìˆ˜ë™ ì‹¤í–‰ (ì „ë¬¸ê°€ìš©)
```bash
# ìˆ˜ë™ ë°±ì—… í›„ ì‹¤í–‰
pg_dump -h [í˜¸ìŠ¤íŠ¸] -U [ì‚¬ìš©ìëª…] -d [ë°ì´í„°ë² ì´ìŠ¤ëª…] > backup_manual.sql
npm run migration:run
```

## ğŸ†˜ ë¬¸ì œ ë°œìƒ ì‹œ ë³µêµ¬ ë°©ë²•

### 1. ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡¤ë°±
```bash
./safe-migration.sh rollback
```

### 2. ë°±ì—…ì—ì„œ ë³µêµ¬
```bash
./safe-migration.sh restore
```

### 3. ìˆ˜ë™ ë³µêµ¬
```bash
# ë°±ì—… íŒŒì¼ì—ì„œ ìˆ˜ë™ ë³µêµ¬
psql -h [í˜¸ìŠ¤íŠ¸] -U [ì‚¬ìš©ìëª…] -d [ë°ì´í„°ë² ì´ìŠ¤ëª…] < backup_íŒŒì¼ëª….sql
```

## ğŸ“‹ ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì‹¤í–‰ ì „
- [ ] í™˜ê²½ë³€ìˆ˜ ì„¤ì • í™•ì¸ (DB_HOST, DB_USER, DB_NAME)
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì† í™•ì¸
- [ ] ë””ìŠ¤í¬ ê³µê°„ ì¶©ë¶„í•œì§€ í™•ì¸ (ë°±ì—…ìš©)
- [ ] ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ (ì„ íƒì‚¬í•­)

### ì‹¤í–‰ ì¤‘
- [ ] ë°±ì—… íŒŒì¼ ìƒì„±ë¨
- [ ] ê° ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„ ì„±ê³µ í™•ì¸
- [ ] ì—ëŸ¬ ë¡œê·¸ í™•ì¸

### ì‹¤í–‰ í›„
- [ ] ìƒˆ í…Œì´ë¸” êµ¬ì¡° í™•ì¸
- [ ] ê¸°ì¡´ ë°ì´í„° ë³´ì¡´ í™•ì¸
- [ ] ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ìƒ ë™ì‘ í™•ì¸
- [ ] ë°±ì—… íŒŒì¼ ì•ˆì „í•œ ê³³ì— ë³´ê´€

## ğŸ’¡ ì¶”ê°€ íŒ

### í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ë¨¼ì € ì‹¤í–‰
```bash
# í…ŒìŠ¤íŠ¸ DBì—ì„œ ë¨¼ì € í…ŒìŠ¤íŠ¸
export DB_NAME=test_database
./safe-migration.sh step
```

### ë°±ì—… í…Œì´ë¸” í™•ì¸
```sql
-- ë°±ì—…ëœ wallets í…Œì´ë¸” í™•ì¸
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'spaceengineers' 
AND table_name LIKE 'wallets_backup_%';
```

### ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦
```sql
-- ë§ˆì´ê·¸ë ˆì´ì…˜ í›„ ë°ì´í„° í™•ì¸
SELECT 
    u.username,
    w.balance,
    g.name as game_name,
    c.name as currency_name
FROM spaceengineers.wallets w
JOIN spaceengineers.users u ON w.user_id = u.id
JOIN spaceengineers.games g ON w.game_id = g.id
JOIN spaceengineers.currencies c ON w.currency_id = c.id
LIMIT 10;
```
